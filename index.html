<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BarberApp - Visibilidade Alta</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;800&family=Roboto:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

    <style>
        :root {
            /* Cores de Alto Contraste */
            --gold-bright: #FFD700; /* Amarelo Ouro Vivo */
            --bg-dark: #1a1a1a;
            --card-bg: #2d2d2d;
            --text-white: #ffffff;
            --input-bg: #ffffff; /* Fundo BRANCO para inputs */
            --input-text: #000000; /* Texto PRETO para inputs */
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-white);
            font-family: 'Roboto', sans-serif; /* Fonte mais robusta para leitura */
            font-size: 18px; /* Fonte base maior */
        }

        /* Navbar com contraste */
        .navbar {
            background-color: #000;
            border-bottom: 2px solid var(--gold-bright);
            padding: 15px 0;
        }
        .navbar-brand {
            font-family: 'Montserrat', sans-serif;
            font-weight: 800;
            color: var(--gold-bright) !important;
            font-size: 1.8rem;
            letter-spacing: 1px;
        }

        /* Cards e Layout */
        .card {
            background-color: var(--card-bg);
            border: 1px solid #444;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }

        /* T√≠tulos de Se√ß√£o */
        h1, h2, h3, h4, h5 {
            color: var(--text-white);
            font-weight: 700;
        }

        /* --- MUDAN√áA PRINCIPAL: INPUTS BRANCOS --- */
        label {
            color: #ccc; /* Cinza claro */
            font-size: 1rem;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-control, .form-select {
            background-color: var(--input-bg) !important;
            color: var(--input-text) !important;
            border: 2px solid #999;
            font-size: 1.2rem; /* Letra grande ao digitar */
            font-weight: 600;
            padding: 12px;
            border-radius: 8px;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--gold-bright);
            box-shadow: 0 0 0 4px rgba(255, 215, 0, 0.3);
        }

        /* Bot√µes Gigantes */
        .btn-gold {
            background-color: var(--gold-bright);
            color: #000;
            font-weight: 800;
            font-size: 1.2rem;
            text-transform: uppercase;
            padding: 15px;
            border: none;
        }
        .btn-gold:hover {
            background-color: #ffed4a;
            transform: scale(1.02);
        }

        /* Abas Grandes */
        .nav-tabs .nav-link {
            color: #aaa;
            font-size: 1.1rem;
            padding: 15px;
        }
        .nav-tabs .nav-link.active {
            background-color: transparent !important;
            color: var(--gold-bright) !important;
            border-bottom: 4px solid var(--gold-bright) !important;
            font-weight: bold;
        }

        /* Utilit√°rios */
        .hidden { display: none !important; }
        .text-gold { color: var(--gold-bright) !important; }
        
        /* Badges de Profissional (Grandes) */
        .badge-pro { font-size: 0.9rem; padding: 8px 12px; }
        .bg-fernando { background-color: var(--gold-bright); color: #000; }
        .bg-denver { background-color: #00ff88; color: #000; }

        /* Tabela Leg√≠vel */
        .table-custom tr td {
            background-color: #2d2d2d;
            color: white;
            font-size: 1.1rem;
            padding: 12px 8px;
            border-bottom: 1px solid #444;
            vertical-align: middle;
        }
    </style>
</head>
<body>

<nav class="navbar sticky-top">
    <div class="container d-flex justify-content-between align-items-center">
        <span class="navbar-brand mb-0">BARBER<span class="text-white">APP</span></span>
        <button id="btnSair" class="btn btn-outline-light btn-sm fw-bold hidden" onclick="logout()">
            SAIR
        </button>
    </div>
</nav>

<div class="container mt-3 pb-5">

    <div id="loginScreen" class="card p-4 mx-auto mt-4" style="max-width: 400px;">
        <div class="text-center mb-4">
            <h2 class="text-gold">LOGIN</h2>
            <p class="text-white">Entre para come√ßar</p>
        </div>
        
        <form onsubmit="fazerLogin(event)">
            <div class="mb-3">
                <label>Email</label>
                <input type="email" id="emailLogin" class="form-control" placeholder="Digite seu email" required>
            </div>
            <div class="mb-4">
                <label>Senha</label>
                <input type="password" id="senhaLogin" class="form-control" placeholder="Sua senha" required>
            </div>
            <div class="d-grid">
                <button type="submit" class="btn btn-gold rounded-3">ENTRAR</button>
            </div>
            <div id="loginError" class="text-danger text-center mt-3 fw-bold hidden"></div>
        </form>
    </div>

    <div id="mainPanel" class="hidden fade-in">
        
        <ul class="nav nav-tabs nav-fill mb-3" id="myTab" role="tablist">
            <li class="nav-item">
                <button class="nav-link active" id="lancar-tab" data-bs-toggle="tab" data-bs-target="#lancar" type="button">
                    LAN√áAR
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" id="relatorio-tab" data-bs-toggle="tab" data-bs-target="#relatorio" type="button">
                    CAIXA
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" id="chatbot-tab" data-bs-toggle="tab" data-bs-target="#chatbot" type="button">
                    ZAP
                </button>
            </li>
        </ul>

        <div class="tab-content">
            
            <div class="tab-pane fade show active" id="lancar">
                <div class="card p-3">
                    <form onsubmit="salvarServico(event)">
                        
                        <div class="mb-3">
                            <label class="text-gold fw-bold">QUEM CORTOU?</label>
                            <select id="profissionalSelect" class="form-select" style="font-weight: 800;">
                                <option value="Fernando">üëë FERNANDO (DONO)</option>
                                <option value="Denver">‚úÇÔ∏è DENVER (COLAB)</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label>NOME DO CLIENTE</label>
                            <input type="text" id="clienteNome" class="form-control" placeholder="Ex: Jo√£o" required>
                        </div>
                        
                        <div class="mb-3">
                            <label>SERVI√áO</label>
                            <select id="tipoServico" class="form-select">
                                <option value="Corte Degrad√™">Corte Degrad√™</option>
                                <option value="Corte Social">Corte Social</option>
                                <option value="Barba">Barba</option>
                                <option value="Corte + Barba">Combo (Corte+Barba)</option>
                                <option value="Sobrancelha">Sobrancelha</option>
                            </select>
                        </div>

                        <div class="mb-4">
                            <label>VALOR (R$)</label>
                            <input type="number" id="valorServico" class="form-control" placeholder="0,00" step="0.01" inputmode="decimal" required>
                        </div>

                        <div class="d-grid">
                            <button type="submit" class="btn btn-gold rounded-3 shadow">
                                SALVAR LAN√áAMENTO
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="tab-pane fade" id="relatorio">
                
                <div class="row g-2 mb-3">
                    <div class="col-6">
                        <div class="card p-3 text-center" style="border: 2px solid #00ff88;">
                            <small class="text-uppercase fw-bold text-white">Denver (60%)</small>
                            <h2 style="color: #00ff88;">R$<span id="saldoDenver">0</span></h2>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="card p-3 text-center" style="border: 2px solid var(--gold-bright);">
                            <small class="text-uppercase fw-bold text-white">Fernando (Total)</small>
                            <h2 class="text-gold">R$<span id="saldoFernando">0</span></h2>
                        </div>
                    </div>
                </div>

                <div class="card p-2">
                    <h5 class="text-white p-2 mb-0">Hist√≥rico de Hoje</h5>
                    <div class="table-responsive">
                        <table class="table table-custom w-100 mb-0">
                            <thead>
                                <tr style="color: #888; font-size: 0.8rem;">
                                    <th>QUEM</th>
                                    <th>CLI.</th>
                                    <th class="text-end">VALOR</th>
                                </tr>
                            </thead>
                            <tbody id="listaHistorico">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="chatbot">
                <h5 class="text-white mb-3">Fila de Espera</h5>
                <div id="chatbotList" class="list-group">
                    </div>
            </div>

        </div> 
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, Timestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
    import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

    // --- SEU FIREBASE CONFIG (MANTIDO) ---
    const firebaseConfig = {
        apiKey: "AIzaSyDcIDq8AEmL48Z9IFy7-fzBTY6yiFTzTL4",
        authDomain: "appbarber-cf462.firebaseapp.com",
        projectId: "appbarber-cf462",
        storageBucket: "appbarber-cf462.firebasestorage.app",
        messagingSenderId: "252056091488",
        appId: "1:252056091488:web:8a483735cf8186ce24bc05",
        measurementId: "G-8L2WJPVW6G"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const colecaoVendas = collection(db, "lancamentos");

    // Login State
    onAuthStateChanged(auth, (user) => {
        if (user) {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainPanel').classList.remove('hidden');
            document.getElementById('btnSair').classList.remove('hidden');
            iniciarEscutaEmTempoReal();
            carregarChatbotMock();
        } else {
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('mainPanel').classList.add('hidden');
            document.getElementById('btnSair').classList.add('hidden');
        }
    });

    window.fazerLogin = function(e) {
        e.preventDefault();
        const email = document.getElementById('emailLogin').value;
        const pass = document.getElementById('senhaLogin').value;
        const errorMsg = document.getElementById('loginError');

        errorMsg.classList.add('hidden');
        signInWithEmailAndPassword(auth, email, pass)
            .catch((error) => {
                errorMsg.innerText = "Erro: Verifique email e senha.";
                errorMsg.classList.remove('hidden');
            });
    }

    window.logout = function() {
        signOut(auth).then(() => location.reload());
    }

    // --- SALVAR (REGRA 60/40) ---
    window.salvarServico = async function(e) {
        e.preventDefault();
        
        const profissional = document.getElementById('profissionalSelect').value;
        const cliente = document.getElementById('clienteNome').value;
        const servico = document.getElementById('tipoServico').value;
        const valorTotal = parseFloat(document.getElementById('valorServico').value);

        if(!cliente || !valorTotal) return;

        let ganhoDenver = 0;
        let ganhoFernando = 0;

        if (profissional === "Denver") {
            ganhoDenver = valorTotal * 0.60;
            ganhoFernando = valorTotal * 0.40;
        } else {
            ganhoDenver = 0;
            ganhoFernando = valorTotal;
        }

        try {
            await addDoc(colecaoVendas, {
                profissional: profissional,
                cliente: cliente,
                servico: servico,
                total: valorTotal,
                ganho_denver: ganhoDenver,
                ganho_fernando: ganhoFernando,
                data: Timestamp.now()
            });
            
            // Feedback simples e visual
            alert(`‚úÖ SALVO!\nProfissional: ${profissional}\nValor: R$ ${valorTotal}`);
            
            document.getElementById('clienteNome').value = '';
            document.getElementById('valorServico').value = '';
            document.getElementById('clienteNome').focus();

        } catch (error) {
            alert("Erro de conex√£o.");
        }
    }

    // --- LEITURA DO BANCO ---
    function iniciarEscutaEmTempoReal() {
        const q = query(colecaoVendas, orderBy("data", "asc"));

        onSnapshot(q, (snapshot) => {
            let saldoD = 0;
            let saldoF = 0;
            const tbody = document.getElementById('listaHistorico');
            tbody.innerHTML = '';

            const vendas = [];
            snapshot.forEach((doc) => vendas.push({ id: doc.id, ...doc.data() }));

            // Mostra mais recente em cima
            vendas.reverse().forEach(item => {
                saldoD += item.ganho_denver || 0;
                saldoF += item.ganho_fernando || 0;

                let badgeClass = item.profissional === 'Fernando' ? 'bg-fernando' : 'bg-denver';
                let nomeProf = item.profissional === 'Fernando' ? 'FER' : 'DEN';

                let row = `<tr>
                    <td><span class="badge badge-pro ${badgeClass}">${nomeProf}</span></td>
                    <td>
                        <div class="fw-bold">${item.cliente}</div>
                        <div style="font-size: 0.8rem; color: #aaa;">${item.servico}</div>
                    </td>
                    <td class="text-end fw-bold text-gold">R$${item.total.toFixed(0)}</td>
                </tr>`;
                tbody.innerHTML += row;
            });

            document.getElementById('saldoDenver').innerText = saldoD.toFixed(0); // Sem centavos no card pra facilitar leitura
            document.getElementById('saldoFernando').innerText = saldoF.toFixed(0);
        });
    }

    // --- MOCK CHATBOT ---
    window.carregarChatbotMock = function() {
        const pedidos = [
            { cliente: "Carlos (Zap)", servico: "Corte", hora: "14:30" },
            { cliente: "Pedro (Site)", servico: "Barba", hora: "15:00" }
        ];
        const lista = document.getElementById('chatbotList');
        
        if(lista) {
            lista.innerHTML = '';
            pedidos.forEach(p => {
                lista.innerHTML += `
                    <div class="list-group-item d-flex justify-content-between align-items-center p-3 mb-2 bg-dark border-secondary">
                        <div>
                            <div class="fw-bold text-white fs-5">${p.cliente}</div>
                            <div class="text-muted">${p.servico} - ${p.hora}</div>
                        </div>
                        <button class="btn btn-success fw-bold" onclick="importarPedido('${p.cliente}')">
                            LAN√áAR
                        </button>
                    </div>`;
            });
        }
    }

    window.importarPedido = function(nome) {
        document.getElementById('clienteNome').value = nome;
        const triggerEl = document.querySelector('#lancar-tab');
        const tab = new bootstrap.Tab(triggerEl);
        tab.show();
    }
</script>

</body>
</html>
